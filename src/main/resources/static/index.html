<html>
<head>
  <link rel="stylesheet" href="https://unpkg.com/@bpmn-io/form-js@0.7.2/dist/assets/form-js.css">
  <style>
    #form {
      max-width: 800px;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
<div id="success"><span id="success-message"></span></div>
<div id="form"></div>

<script src="https://unpkg.com/@bpmn-io/form-js@0.10.0/dist/form-viewer.umd.js"></script>

<script>
  let forms = ['registration_data.json', 'choose-option.json'];
  let currentFormIndex = 0;

  function loadForm() {
    if (currentFormIndex >= forms.length) {
      // Wszystkie formularze zostały przetworzone
      return;
    }

    let formName = forms[currentFormIndex];
    $.getJSON('/' + formName, function(data) {
      const schema = data;
      const container = document.querySelector('#form');

      // Usuń zawartość kontenera formularza
      container.innerHTML = '';

      FormViewer.createForm({
        container,
        schema
      }).then(function(form) {
        console.log(form);
        form.on('submit', event => {
          console.log('Form <submit>', event, event.data);

          // Sprawdź, czy wszystkie wymagane pola są wypełnione
          let isValid = true;
          for (let key in event.data) {
            if (event.data[key] === '') {
              isValid = false;
              break;
            }
          }

          if (!isValid) {
            alert('Proszę wypełnić wszystkie wymagane pola.');
            return;
          }

          $.ajax("/start", {
            data : JSON.stringify(event.data),
            contentType : 'application/json',
            type : 'POST',
            success: function(data) {
              form.reset();
              $('#success-message').html("<b>Sala konferencyjna zarezerwowana w wybranym terminie.</b>");
              // Sprawdź, czy użytkownik wybrał "Retry reservation"
              if (event.data.radio_805ey6 === 'Retry') {
                // Resetuj indeks formularza do początkowego formularza
                currentFormIndex = 0;
              } else {
                // Przejdź do następnego formularza
                currentFormIndex++;
              }

              loadForm();
            }
          });
        });
      });
    });
  }

  // Rozpocznij ładowanie formularzy
  loadForm();
</script>
</body>
</html>
